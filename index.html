<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#0f172a">
    <title>–ü–î–î –≠–∫–∑–∞–º–µ–Ω</title>
    
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Google Auth -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ VK Open API -->
    <script src="https://vk.com/js/api/openapi.js?169" type="text/javascript"></script>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Firebase (–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="mobile.css">
</head>
<body>
    <!-- –ú–æ–±–∏–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="mobile-nav-overlay" id="mobile-nav-overlay" onclick="app.closeMobileNav()"></div>
    <nav class="mobile-nav" id="mobile-nav">
        <div class="mobile-nav-header">
            <div class="mobile-user">
                <div class="profile-avatar-small" id="mobile-avatar">üë§</div>
                <span id="mobile-username">–ü—Ä–æ—Ñ–∏–ª—å</span>
            </div>
            <button class="mobile-close-btn" onclick="app.closeMobileNav()">‚úï</button>
        </div>
        <div class="mobile-nav-items">
            <button class="mobile-nav-item" onclick="app.navigate('tickets')">
                <span class="nav-icon">üìö</span> –ë–∏–ª–µ—Ç—ã
            </button>
            <button class="mobile-nav-item" onclick="app.navigate('ranges')">
                <span class="nav-icon">üéØ</span> –î–∏–∞–ø–∞–∑–æ–Ω
            </button>
            <button class="mobile-nav-item" onclick="app.navigate('marathon-intro')">
                <span class="nav-icon">üèÉ</span> –ú–∞—Ä–∞—Ñ–æ–Ω
            </button>
            <button class="mobile-nav-item" onclick="app.navigate('exam-start')">
                <span class="nav-icon">üìù</span> –≠–∫–∑–∞–º–µ–Ω
            </button>
            <button class="mobile-nav-item" onclick="app.navigate('mistakes')">
                <span class="nav-icon">‚ö†Ô∏è</span> –û—à–∏–±–∫–∏
            </button>
            <button class="mobile-nav-item" onclick="app.handleProfileClick()">
                <span class="nav-icon">üë§</span> –ü—Ä–æ—Ñ–∏–ª—å
            </button>
        </div>
        <div class="mobile-nav-footer">
            <button class="text-btn" onclick="app.logout()">–í—ã–π—Ç–∏</button>
        </div>
    </nav>

    <header id="main-header" style="display:none;">
        <div class="header-inner">
            <!-- –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é -->
            <button class="mobile-menu-btn" onclick="app.openMobileNav()" aria-label="–ú–µ–Ω—é">
                <span></span><span></span><span></span>
            </button>
            
            <!-- –õ–æ–≥–æ—Ç–∏–ø/–ù–∞–∑–≤–∞–Ω–∏–µ -->
            <div class="header-title">–ü–î–î</div>
            
            <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
            <div class="profile-nav-btn" onclick="app.handleProfileClick()">
                <span id="header-username">–ü—Ä–æ—Ñ–∏–ª—å</span>
                <div class="profile-avatar-small" id="header-avatar">üë§</div>
            </div>
        </div>
    </header>

    <main>
        <div class="container" id="main-container">

            <!-- 0. –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø -->
            <section id="view-auth" class="view-section active">
                <div class="auth-card">
                    <div class="soft-icon profile">
                        <div class="shape-1"></div>
                        <div class="shape-2"></div>
                    </div>
                    <h2 id="auth-title">–í—Ö–æ–¥ –≤ –ø—Ä–æ—Ñ–∏–ª—å</h2>
                    <p style="color:#57606a; margin-bottom:20px;">–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏.</p>
                    
                    <!-- –°–æ—Ü—Å–µ—Ç–∏ -->
                    <div class="social-auth">
                        <!-- –ö–Ω–æ–ø–∫–∞ VK -->
                        <button class="vk-btn" onclick="app.loginVK()">
                            <span style="font-weight:bold; margin-right:8px; font-family: sans-serif;">VK</span> –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ
                        </button>
                        
                        <div style="height: 10px;"></div>

                        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–∫–∏ Google -->
                        <div id="google_btn_container"></div>
                    </div>

                    <div class="divider">–∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å</div>

                    <div class="auth-form">
                        <input type="text" id="auth-login" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –õ–æ–≥–∏–Ω" autocomplete="off">
                        <input type="password" id="auth-pass" placeholder="–ü–∞—Ä–æ–ª—å">
                        <button class="primary-btn large-btn" style="width:100%; margin-top:10px;" onclick="app.performAuth()">–í–æ–π—Ç–∏</button>
                    </div>

                    <div class="auth-footer">
                        <span id="auth-toggle-text">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?</span>
                        <button class="text-btn" onclick="app.toggleAuthMode()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                        <p style="font-size: 10px; margin-top: 10px; color: #999;">–õ–æ–∫–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ.</p>
                    </div>
                </div>
            </section>

            <!-- 0.1 –ü–†–û–§–ò–õ–¨ -->
            <section id="view-profile" class="view-section">
                <div class="profile-header-card">
                    <div class="profile-avatar-large" id="profile-avatar-large">üë§</div>
                    <div class="profile-info">
                        <h2 id="profile-name" style="margin:0; color:#fff;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</h2>
                        <p id="profile-sync-status" style="color:#adbac7; font-size:14px; margin-top:5px;">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞</p>
                    </div>
                    <button class="secondary-btn-dark" onclick="app.logout()">–í—ã–π—Ç–∏</button>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="stat-tickets">0</div>
                        <div class="stat-desc">–†–µ—à–µ–Ω–æ –±–∏–ª–µ—Ç–æ–≤</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-mistakes">0</div>
                        <div class="stat-desc">–û—à–∏–±–æ–∫ –Ω–∞–∫–æ–ø–ª–µ–Ω–æ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-exam">0%</div>
                        <div class="stat-desc">–£—Å–ø–µ—à–Ω–æ—Å—Ç—å —ç–∫–∑–∞–º–µ–Ω–æ–≤</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-marathon">0/800</div>
                        <div class="stat-desc">–ü—Ä–æ–≥—Ä–µ—Å—Å –º–∞—Ä–∞—Ñ–æ–Ω–∞</div>
                    </div>
                </div>
            </section>
            
            <!-- 1. –ë–ò–õ–ï–¢–´ -->
            <section id="view-tickets" class="view-section">
                <div class="menu-card-rect">
                    <div class="soft-icon tickets">
                        <div class="shape-1"></div>
                        <div class="shape-2"></div>
                    </div>
                    <div class="menu-card-info">
                        <h3>–£—á–µ–±–Ω—ã–µ –±–∏–ª–µ—Ç—ã</h3>
                        <p>–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Å–ø–æ—Å–æ–± –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏. 40 –±–∏–ª–µ—Ç–æ–≤ –ø–æ 20 –≤–æ–ø—Ä–æ—Å–æ–≤.</p>
                    </div>
                </div>
                <div class="content-box">
                    <div id="tickets-menu" class="btn-grid">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
            </section>

            <!-- 2. –î–ò–ê–ü–ê–ó–û–ù -->
            <section id="view-ranges" class="view-section">
                <div class="menu-card-rect">
                    <div class="soft-icon range">
                        <div class="shape-1"></div>
                        <div class="shape-2"></div>
                    </div>
                    <div class="menu-card-info">
                        <h3>–í—ã–±–æ—Ä –¥–∏–∞–ø–∞–∑–æ–Ω–∞</h3>
                        <p>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Ç–æ—á–µ—á–Ω–æ–π –æ—Ç—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–º.</p>
                    </div>
                </div>
                
                <div class="content-box" style="text-align: center;">
                    <div class="range-controls">
                        <div class="range-inputs">
                            <div class="input-group">
                                <label>–° –≤–æ–ø—Ä–æ—Å–∞ ‚Ññ</label>
                                <input type="number" id="range-start" min="1" max="20" placeholder="1" value="1">
                            </div>
                            <div class="input-group">
                                <label>–ü–æ –≤–æ–ø—Ä–æ—Å ‚Ññ</label>
                                <input type="number" id="range-end" min="1" max="20" placeholder="20" value="1">
                            </div>
                        </div>

                        <button class="primary-btn large-btn" style="margin-top:25px; width:100%;" onclick="app.startRangeCustom()">–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
                    </div>
                </div>
            </section>

            <!-- 3. –ú–ê–†–ê–§–û–ù -->
            <section id="view-marathon-intro" class="view-section">
                <div class="intro-card">
                    <div class="soft-icon marathon">
                        <div class="shape-1"></div>
                        <div class="shape-2"></div>
                        <div class="shape-3"></div>
                    </div>
                    
                    <h2>–ú–∞—Ä–∞—Ñ–æ–Ω 800</h2>
                    <p>–í—Å–µ 800 –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ –æ–¥–Ω–æ–º –∑–∞–±–µ–≥–µ.</p>
                    <div style="margin-top: 30px;">
                        <button class="primary-btn large-btn" onclick="app.startMarathon()">–ù–∞—á–∞—Ç—å –º–∞—Ä–∞—Ñ–æ–Ω</button>
                    </div>
                    <p style="font-size: 12px; color: #57606a; margin-top: 15px;">–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</p>
                </div>
            </section>

            <!-- 4. –≠–ö–ó–ê–ú–ï–ù -->
            <section id="view-exam-start" class="view-section">
                <div class="intro-card">
                    <div class="soft-icon exam">
                        <div class="shape-1"></div>
                        <div class="shape-2"></div>
                        <div class="shape-3"></div>
                    </div>

                    <h2>–≠–∫–∑–∞–º–µ–Ω –ì–ò–ë–î–î</h2>
                    
                    <div class="exam-rules-list">
                        <div style="margin-bottom:5px;">‚è± 20 –≤–æ–ø—Ä–æ—Å–æ–≤ / 20 –º–∏–Ω—É—Ç</div>
                        <div style="margin-bottom:5px;">‚ö† 1 –æ—à–∏–±–∫–∞ = +5 –¥–æ–ø. –≤–æ–ø—Ä–æ—Å–æ–≤</div>
                        <div>‚ö† 2 –æ—à–∏–±–∫–∏ (—Ä–∞–∑–Ω—ã–µ –±–ª–æ–∫–∏) = +10 –¥–æ–ø. –≤–æ–ø—Ä–æ—Å–æ–≤</div>
                    </div>

                    <div style="margin-top: 30px;">
                        <button class="primary-btn large-btn" onclick="app.startRealExam()">–ù–∞—á–∞—Ç—å —ç–∫–∑–∞–º–µ–Ω</button>
                    </div>
                </div>
            </section>

            <!-- 5. –î–ê–®–ë–û–†–î –≠–ö–ó–ê–ú–ï–ù–ê -->
            <section id="view-exam-dashboard" class="view-section full-width">
                <div class="dashboard-header">
                    <div class="dash-timer" id="dash-timer">20:00</div>
                    <div style="flex:1"></div>
                    <button class="nav-btn" style="background:#2d333b; color:#adbac7; border:1px solid #444c56; z-index: 10;" onclick="app.finishExamEarly()">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
                </div>
                <div id="exam-grid" class="exam-grid-container"></div>
            </section>

            <!-- 6. –û–®–ò–ë–ö–ò -->
            <section id="view-mistakes" class="view-section">
                <div class="menu-card-rect">
                    <div class="soft-icon mistakes">
                        <div class="shape-1"></div>
                        <div class="shape-2"></div>
                        <div class="shape-3"></div>
                    </div>
                    <div class="menu-card-info">
                        <h3>–†–∞–±–æ—Ç–∞ –Ω–∞–¥ –æ—à–∏–±–∫–∞–º–∏</h3>
                        <p>–í–æ–ø—Ä–æ—Å—ã, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –≤—ã –æ—à–∏–±–ª–∏—Å—å, —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∑–¥–µ—Å—å.</p>
                    </div>
                </div>

                <div class="content-box">
                    <div id="mistakes-controls" style="text-align: center; margin-bottom: 20px;"></div>
                    <div id="mistakes-grid" class="grid-simple"></div>
                </div>
            </section>

            <!-- 7. –í–û–ü–†–û–°–´ (—Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π) -->
            <section id="view-questions" class="view-section">
                <div id="marathon-stats" class="marathon-stats-bar" style="display:none;">
                    <div class="stat-item">
                        <span class="stat-val" style="color:var(--color-success-fg)" id="m-correct">0</span>
                        <span class="stat-label">–í–µ—Ä–Ω–æ</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-val" style="color:var(--color-danger-fg)" id="m-wrong">0</span>
                        <span class="stat-label">–û—à–∏–±–∫–∏</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-val" style="color:#0969da" id="m-total">0/800</span>
                        <span class="stat-label">–ü—Ä–æ–≥—Ä–µ—Å—Å</span>
                    </div>
                </div>
                
                <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–≤–∞–π–ø–∞ -->
                <div class="swipe-container" id="swipe-container">
                    <div id="pagination" class="pagination-container"></div>
                    <div id="marathon-pagination" class="marathon-grid" style="display:none;"></div>
                    
                    <div class="question-swipe-wrapper">
                        <div class="question-card-swipe" id="current-question-card">
                            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–æ–ø—Ä–æ—Å–∞ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                        </div>
                    </div>
                    
                    <div class="swipe-hint">
                        <span class="swipe-arrow">‚Üê</span> –õ–∏—Å—Ç–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã
                        <span class="swipe-arrow">‚Üí</span>
                    </div>
                </div>
                
                <div class="nav-controls">
                    <button onclick="app.goBack()">–ú–µ–Ω—é</button>
                    <button id="btn-prev" class="secondary-btn-dark" onclick="app.prevQuestion()" style="display:none;">‚Üê –ù–∞–∑–∞–¥</button>
                    <button id="btn-next" class="primary-btn" onclick="app.nextQuestion()">–î–∞–ª–µ–µ ‚Üí</button>
                    <button id="btn-finish-train" class="primary-btn" onclick="app.finishTraining()" style="display:none;">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
                </div>
            </section>

            <!-- 8. –ò–¢–û–ì–ò -->
            <section id="view-summary" class="view-section">
                <div class="content-box" style="text-align:center;">
                    <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç</h2>
                    <div class="summary-stats">
                        <div style="display:inline-block; margin:0 20px;">
                            <b id="sum-time" style="font-size:24px; display:block;">00:00</b>
                            <span style="color:#57606a;">–í—Ä–µ–º—è</span>
                        </div>
                        <div style="display:inline-block; margin:0 20px;">
                            <b id="sum-errors" style="font-size:24px; color:var(--color-danger-fg); display:block;">0</b>
                            <span style="color:#57606a;">–û—à–∏–±–∫–∏</span>
                        </div>
                    </div>
                    <div id="exam-result-message" style="margin-top:20px; font-weight:bold; font-size: 18px;"></div>
                    <br>
                    <button class="primary-btn large-btn" onclick="app.navigate('tickets')">–í –º–µ–Ω—é</button>
                </div>
                <div id="summary-errors-list" style="margin-top:20px;"></div>
            </section>

        </div>
    </main>

    <!-- –ú–û–î–ê–õ–ö–ò -->
    <div id="exam-modal" class="modal-overlay">
        <div class="modal-content dark-modal">
            <div id="exam-modal-question"></div>
            <div class="modal-footer dark-footer">
                <div style="font-size:12px; opacity:0.7;">Enter - –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</div>
                <div style="display:flex; gap:10px;">
                    <button onclick="app.closeExamModal()" class="secondary-btn-dark">–ó–∞–∫—Ä—ã—Ç—å</button>
                    <button id="btn-confirm-exam" class="primary-btn" disabled onclick="app.confirmExamAnswer()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <div id="exam-result-modal" class="modal-overlay">
        <div class="modal-content result-modal-content dark-modal" style="padding:40px; text-align:center;">
            <h2 id="modal-res-title"></h2>
            <p id="modal-res-text" style="font-size: 16px; margin: 20px 0;"></p>
            <div class="modal-actions" style="display:flex; gap:10px; justify-content:center;">
                <button onclick="app.finishExamReview()" class="secondary-btn-dark">–†–∞–∑–±–æ—Ä</button>
                <button class="primary-btn" onclick="app.startRealExam()">–ó–∞–Ω–æ–≤–æ</button>
            </div>
        </div>
    </div>
    <div id="confirm-modal" class="modal-overlay" style="z-index: 300;">
        <div class="modal-content dark-modal" style="max-width: 400px; height: auto; padding: 30px; text-align: center; border-radius: 12px;">
            <h3 style="margin-top: 0; margin-bottom: 15px;">–í—ã—Ö–æ–¥ –∏–∑ —ç–∫–∑–∞–º–µ–Ω–∞</h3>
            <p style="color: #adbac7; margin-bottom: 25px;">–í—ã —É–≤–µ—Ä–µ–Ω—ã? –¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å —ç–∫–∑–∞–º–µ–Ω–∞ –±—É–¥–µ—Ç –ø–æ—Ç–µ—Ä—è–Ω.</p>
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button class="secondary-btn-dark" style="width: 100px;" onclick="app.cancelExit()">–ù–µ—Ç</button>
                <button class="primary-btn" style="background-color: var(--color-danger-fg); border-color: var(--color-danger-fg); width: 100px;" onclick="app.confirmExit()">–î–∞, –≤—ã–π—Ç–∏</button>
            </div>
        </div>
    </div>
    <script src="script.js"></script>
</body>
</html>
