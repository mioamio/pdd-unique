<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>PDD Premium</title>
    
    <!-- Google Auth -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <!-- VK Open API -->
    <script src="https://vk.com/js/api/openapi.js?169" type="text/javascript"></script>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <link rel="stylesheet" href="style.css">
</head>
<body class="loading-state">

    <!-- Экран загрузки (предотвращает мигание) -->
    <div id="app-loader">
        <div class="spinner"></div>
    </div>

    <header id="main-header" style="display:none;">
        <div class="header-inner">
            <nav class="nav-bar">
                <button class="nav-btn" data-target="tickets" onclick="app.navigate('tickets')">Билеты</button>
                <button class="nav-btn" data-target="ranges" onclick="app.navigate('ranges')">Темы</button>
                <button class="nav-btn" data-target="marathon-intro" onclick="app.navigate('marathon-intro')">Марафон</button>
                <button class="nav-btn" data-target="exam-start" onclick="app.navigate('exam-start')">Экзамен</button>
                <button class="nav-btn" data-target="mistakes" onclick="app.navigate('mistakes')">Ошибки</button>
            </nav>
            
            <div class="profile-nav-btn" onclick="app.handleProfileClick()">
                <div class="profile-avatar-small" id="header-avatar"></div>
            </div>
        </div>
    </header>

    <main>
        <div class="container" id="main-container">

            <!-- 0. АВТОРИЗАЦИЯ -->
            <section id="view-auth" class="view-section">
                <div class="auth-card">
                    <h2>Вход</h2>
                    <p class="subtitle">Синхронизация прогресса</p>
                    
                    <div class="social-auth">
                        <button class="vk-btn" onclick="app.loginVK()">
                            VK ID
                        </button>
                        <div style="height: 10px;"></div>
                        <div id="google_btn_container"></div>
                    </div>

                    <div class="divider">или локально</div>

                    <div class="auth-form">
                        <input type="text" id="auth-login" placeholder="Логин" autocomplete="off">
                        <input type="password" id="auth-pass" placeholder="Пароль">
                        <button class="primary-btn large-btn full-width" onclick="app.performAuth()">Войти</button>
                    </div>

                    <div class="auth-footer">
                        <button class="text-btn" onclick="app.toggleAuthMode()">Регистрация / Вход</button>
                    </div>
                </div>
            </section>

            <!-- 0.1 ПРОФИЛЬ -->
            <section id="view-profile" class="view-section">
                <div class="profile-header-card">
                    <div class="profile-avatar-large" id="profile-avatar-large"></div>
                    <div class="profile-info">
                        <h2 id="profile-name">Пользователь</h2>
                        <p id="profile-sync-status">Статус синхронизации</p>
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="stat-tickets">0</div>
                        <div class="stat-desc">Билетов</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-mistakes">0</div>
                        <div class="stat-desc">Ошибок</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-exam">0%</div>
                        <div class="stat-desc">Успешность</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="stat-marathon">0</div>
                        <div class="stat-desc">Марафон</div>
                    </div>
                </div>
                <button class="secondary-btn-dark full-width" style="margin-top:20px" onclick="app.logout()">Выйти</button>
            </section>
            
            <!-- 1. БИЛЕТЫ -->
            <section id="view-tickets" class="view-section">
                <div class="section-header">
                    <h3>Учебные билеты</h3>
                    <p>40 билетов по 20 вопросов</p>
                </div>
                <div id="tickets-menu" class="btn-grid">Загрузка...</div>
            </section>

            <!-- 2. ДИАПАЗОН -->
            <section id="view-ranges" class="view-section">
                <div class="section-header">
                    <h3>Диапазон вопросов</h3>
                    <p>Выберите номера вопросов</p>
                </div>
                
                <div class="content-box">
                    <div class="range-controls">
                        <div class="range-inputs">
                            <div class="input-group">
                                <label>От</label>
                                <input type="number" id="range-start" min="1" max="20" placeholder="1" value="1">
                            </div>
                            <div class="input-group">
                                <label>До</label>
                                <input type="number" id="range-end" min="1" max="20" placeholder="20" value="1">
                            </div>
                        </div>
                        <button class="primary-btn large-btn full-width" style="margin-top:20px;" onclick="app.startRangeCustom()">Начать</button>
                    </div>
                </div>
            </section>

            <!-- 3. МАРАФОН -->
            <section id="view-marathon-intro" class="view-section">
                <div class="intro-card">
                    <h2>Марафон 800</h2>
                    <p>Все вопросы подряд без ограничений по времени.</p>
                    <div style="margin-top: 30px;">
                        <button class="primary-btn large-btn full-width" onclick="app.startMarathon()">Начать</button>
                    </div>
                </div>
            </section>

            <!-- 4. ЭКЗАМЕН (START) -->
            <section id="view-exam-start" class="view-section">
                <div class="intro-card exam-intro">
                    <h2>Экзамен ГИБДД</h2>
                    <div class="exam-rules-list">
                        <div>20 вопросов / 20 минут</div>
                        <div>1 ошибка = +5 вопросов</div>
                        <div>2 ошибки в блоке = провал</div>
                    </div>
                    <div style="margin-top: 30px;">
                        <button class="primary-btn large-btn full-width" onclick="app.startRealExam()">Начать экзамен</button>
                    </div>
                </div>
            </section>

            <!-- 5. ДАШБОРД ЭКЗАМЕНА (НЕ МЕНЯЕМ ЛЕЙАУТ) -->
            <section id="view-exam-dashboard" class="view-section full-width-exam">
                <div class="dashboard-header">
                    <div class="dash-timer" id="dash-timer">20:00</div>
                    <div style="flex:1"></div>
                    <button class="nav-btn small" onclick="app.finishExamEarly()">Завершить</button>
                </div>
                <div id="exam-grid" class="exam-grid-container"></div>
            </section>

            <!-- 6. ОШИБКИ -->
            <section id="view-mistakes" class="view-section">
                <div class="section-header">
                    <h3>Работа над ошибками</h3>
                </div>
                <div class="content-box">
                    <div id="mistakes-controls" style="text-align: center; margin-bottom: 20px;"></div>
                    <div id="mistakes-grid" class="grid-simple"></div>
                </div>
            </section>

            <!-- 7. ВОПРОСЫ (ОБУЧЕНИЕ) -->
            <section id="view-questions" class="view-section">
                
                <!-- Статистика марафона -->
                <div id="marathon-stats" class="marathon-stats-bar" style="display:none;">
                    <div class="stat-item success">
                        <span class="stat-val" id="m-correct">0</span>
                    </div>
                    <div class="stat-item danger">
                        <span class="stat-val" id="m-wrong">0</span>
                    </div>
                    <div class="stat-item neutral">
                        <span class="stat-val" id="m-total">0/800</span>
                    </div>
                </div>

                <!-- Пагинация (Билеты) -->
                <div id="pagination" class="pagination-container"></div>
                <!-- Сетка (Марафон) -->
                <div id="marathon-pagination" class="marathon-grid" style="display:none;"></div>
                
                <!-- Контейнер вопроса -->
                <div id="question-wrapper">
                    <div id="current-question-container"></div>
                </div>

                <div class="nav-controls-bottom">
                    <button class="nav-icon-btn" onclick="app.goBack()">Меню</button>
                    <div class="swipe-hint">Свайп для навигации</div>
                </div>
            </section>

            <!-- 8. ИТОГИ -->
            <section id="view-summary" class="view-section">
                <div class="content-box center-text">
                    <h2>Результат</h2>
                    <div class="summary-stats">
                        <div class="sum-item">
                            <b id="sum-time">00:00</b>
                            <span>Время</span>
                        </div>
                        <div class="sum-item">
                            <b id="sum-errors" class="danger-text">0</b>
                            <span>Ошибки</span>
                        </div>
                    </div>
                    <p id="exam-result-message"></p>
                    <button class="primary-btn large-btn full-width" onclick="app.navigate('tickets')">В меню</button>
                </div>
                <div id="summary-errors-list"></div>
            </section>

        </div>
    </main>

    <!-- МОДАЛКИ (ЭКЗАМЕН) -->
    <div id="exam-modal" class="modal-overlay">
        <div class="modal-content dark-modal">
            <div id="exam-modal-question"></div>
            <div class="modal-footer dark-footer">
                <button onclick="app.closeExamModal()" class="secondary-btn-dark">Закрыть</button>
                <button id="btn-confirm-exam" class="primary-btn" disabled onclick="app.confirmExamAnswer()">Ответить</button>
            </div>
        </div>
    </div>

    <div id="exam-result-modal" class="modal-overlay">
        <div class="modal-content result-modal-content dark-modal">
            <h2 id="modal-res-title"></h2>
            <p id="modal-res-text"></p>
            <div class="modal-actions">
                <button onclick="app.finishExamReview()" class="secondary-btn-dark">Разбор</button>
                <button class="primary-btn" onclick="app.startRealExam()">Заново</button>
            </div>
        </div>
    </div>

    <div id="confirm-modal" class="modal-overlay" style="z-index: 300;">
        <div class="modal-content dark-modal confirm-box">
            <h3>Выход</h3>
            <p>Прогресс экзамена будет потерян.</p>
            <div class="modal-actions">
                <button class="secondary-btn-dark" onclick="app.cancelExit()">Отмена</button>
                <button class="primary-btn danger-btn" onclick="app.confirmExit()">Выйти</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
